#### 时序逻辑和组合逻辑
数字逻辑可分为组合逻辑和时序逻辑。组合逻辑电路由基本的逻辑门电路组成，特点是输出值只与当前的输入值有关，电路没有记忆功能。输出状态随电路的输入状态变化；时序逻辑电路由基本的逻辑门电路和反馈逻辑回路组成，与组合逻辑电路的本质区别在于其具有记忆功能，特点是输出不仅取决于当时的输入值，而且还与电路过去的状态有关。
 
#### 建立时间(setup time)和保持时间(hold up time)
建立时间是指在时钟边沿前数据需要保持不变的时间，保持时间是指时钟跳变边沿后数据需要保持不变的时间。触发器的建立时间和保持时间在时钟上升沿左右定义了一个时间窗口，如果触发器数据输入端口上的数据在这个时间窗口内发生变化（或者数据更新），那么就会产生时序违规。

#### 亚稳态概念与如何预防
亚稳态是指触发器无法在某个规定时间段内达到一个可确认的状态。当一个触发器进入亚稳态时，既无法预测该单元的输出电平，也无法预测何时输出才能稳定在某个正确的电平上。在这个稳定期间，触发器输出一些中间级电平，或者可能处于振荡状态，并且这种无用的输出电平可以沿信号通道上的各个触发器级联式传播下去。
触发器的建立时间和保持时间在时钟上升沿左右定义了一个时间窗口，如果触发器数据输入端口上的数据在这个时间窗口内发生变化（或者数据更新），那么就会产生时序违规。存在这个时序违规是因为违反了建立时间要求和保持时间要求，此时触发器内部的一个节点（一个内部节点或者要输出到外部节点）可能会在一个电压范围内浮动，无法稳定在逻辑0或者逻辑1状态。换句话说，如果数据在上述窗口中被采集，触发器中的晶体管不能可靠地设置为逻辑0或者逻辑1对应的电平上。所以此时的晶体管并未处于饱和区对应的高或者低电平，而是在稳定到一个确定电平之前，徘徊在一个中间电平状态（这个中间电平或许是一个正确值，又或许不是）。如下图所示，这就是所谓的亚稳态。

![异步时钟域亚稳态波形图](https://images2017.cnblogs.com/blog/966190/201709/966190-20170910161534054-653657163.png)

解决方法：
1. 降低系统时钟
2. 用反应更快的FF（Flip-Flop，触发器）
3. 引入同步机制，防止亚稳态传播
4. 改善时钟质量，用边沿变化快速的时钟信号
PS: 关键是器件使用比较好的工艺以及时钟周期的富余量比较大

#### 可综合和不可综合
1. 所有综合工具都支持的结构：always，assign，begin，end，case，wire，tri，aupply0，supply1，reg，integer，default，for，function，and，nand，or，nor，xor，xnor，buf，not，bufif0，bufif1，notif0，notif1，if，inout，input，instantitation，module，negedge，posedge，operators，output，parameter。
2. 所有综合工具都不支持的结构：time，defparam，$finish，fork，join，initial，delays，UDP，wait。
3. 有些工具支持有些工具不支持的结构：casex，casez，wand，triand，wor，trior，real，disable，forever，arrays，memories，repeat，task，while。 

#### 触发器的组成
SR触发器，D触发器

#### 毛刺、竞争、冒险以及如何消除
信号在FPGA器件内部通过连线和逻辑单元时，都有一定的延时。延时的大小与连线的长短和逻辑单元的数目有关，同时还受器件的制造工艺、工作电压、温度等条件的影响。信号的高低电平转换也需要一定的过渡时间。由于存在这两方面因素，多路信号的电平值发生变化时，在信号变化的瞬间，组合逻辑的输出有先后顺序，并不是同时变化,往往会出现一些不正确的尖峰信号，这些尖峰信号称为"毛刺"。如果一个组合逻辑电路中有"毛刺"出现，就说明该电路存在"冒险"。
如果一个门的电路有两个或两个以上的变量发生变化时，由于这些变量时经过不同的路径产生的，使得他们状态的变化有先后，这种时差引起的现象称为竞争。竞争的结果若导致冒险或险象发生，并造成严重的后果，这种竞争称为临界竞争；若竞争没有导致冒险发生，或有冒险发生，但不影响系统的工作，这种竞争成为非临界竞争。
毛刺的消除：
1. 输出加D触发器：原理就是用一个D触发器去读带毛刺的信号，利用D触发器对输入信号的毛刺不敏感的特点，去除信号中的毛刺。
2. 信号同步法：同步电路可大大减少毛刺。
3. 格雷码计数器：使用格雷码计数器将避免毛刺的出现，因为格雷码计数器的输出每次只有一位跳变。
PS：关键是修改逻辑设计以减少同时跳变的信号数量。

#### 状态机（Moore, Mealy）
Moore型：状态的转变只和当前状态有关；
Mealy型：状态的转变不仅和当前状态有关，而且跟各输入信号有关。

#### FIFO
FIFO是英文First In First Out 的缩写，是一种先进先出的数据缓存器，它与普通存储器的区别是没有外部读写地址线，这样使用起来非常简单，但缺点就是只能顺序写入数据，顺序的读出数据，其数据地址由内部读写指针自动加1完成，不能像普通存储器那样可以由地址线决定读取或写入某个指定的地址。

**用途1：**
异步FIFO读写分别采用相互异步的不同时钟。在现代集成电路芯片中，随着设计规模的不断扩大，一个系统中往往含有数个时钟，多时钟域带来的一个问题就是，如何设计异步时钟之间的接口电路。异步FIFO是这个问题的一种简便、快捷的解决方案，使用异步FIFO可以在两个不同时钟系统之间快速而方便地传输实时数据。

**用途2：**
对于不同宽度的数据接口也可以用FIFO，例如单片机位8位数据输出，而DSP可能是16位数据输入，在单片机与DSP连接时就可以使用FIFO来达到数据匹配的目的。

[同步FIFO的verilog实现](../Codes/同步FIFO.v)

**异步FIFO**跨时钟域的问题：由于读指针是属于读时钟域的，写指针是属于写时钟域的，而异步FIFO的读写时钟域不同，是异步的，要是将读时钟域的读指针与写时钟域的写指针不做任何处理直接比较肯定是错误的，因此我们需要进行同步处理以后仔进行比较
解决方法：加两级寄存器同步 + 格雷码（目的都是消除亚稳态）

加两级寄存器同步：即在一个信号进入另一个时钟域之前，将该信号用两个锁存器连续锁存两次（如下图所示）。

![](http://www.ofweek.com/Upload/plainimages/Kevin/images/img6/w80.JPG)

格雷码：在一组数的编码中，若任意两个相邻的代码只有一位二进制数不同，则称这种编码为格雷码（Gray Code）--(0000,0001,0011,0010,0110,0111,0101,0100,1100)
“空”判断：读指针与写指针完全相等
“满”判断：读指针与写指针MSB位和次高位不相等（0100(7), 1000(15)）

[异步FIFO的verilog实现](../Codes/异步FIFO.v)

#### 跨时钟域处理
假如设计中所有的触发器都使用一个全局网络，比如FPGA的主时钟输入，那么我们说这个设计只有一个时钟域。假如设计有两个输入时钟，如下图所示，一个时钟给接口1使用，另一给接口2使用，那么我们说这个设计中有两个时钟域。

![](https://images2017.cnblogs.com/blog/966190/201709/966190-20170910161527960-1397115132.png)

如何处理跨时钟域问题：
1. 单bit：两级触发器同步（适用于慢到快）
2. 多bit：采用异步FIFO，异步双口RAM
3. 加握手信号
4. 格雷码转换

#### 乒乓buffer
ping-pong buffer 也叫双缓存 double buffer, (必须是两个)就是一个缓存在写入的时候, 另一个缓存同时在处理的结构. 用来提高计算机运行速度, 在显示数据处理中常常用到。

#### 奇数偶数小数分频
[奇数分频](../Codes/奇数分频.v)

[偶数分频](../Codes/偶数分频.v)

#### FPGA的内部结构
1. 可编程输入输出单元(Input Output Block, IOB)
2. 可配置逻辑块(Configurable Logic Block, CLB)
3. 数字时钟管理模块(Digital Clock Manager, DCM)
4. 嵌入式块RAM(Block RAM, BRAM)
5. 丰富的布线资源
6. 底层内嵌功能单元
7. 内嵌专用硬核

#### 时序约束的概念和基本策略
时序约束主要包括周期约束、偏移约束、静态时序路径约束三种。通过附加时序约束可以综合布线工具调整映射和布局布线，使设计满足时序要求。
附加时序约束的一般策略是先附加全局约束，然后对快速和慢速的例外路径附加专门约束。

#### 边沿检测
[边沿检测](../Codes/边沿检测.v)